<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Tracker with AI Assistant</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Job Applications</h1>
            <div class="sync-status">
                <div class="sync-dot"></div>
                <span>Auto-sync enabled</span>
            </div>
        </div>

        <!-- Statistics Section -->
        <div class="stats-section">
            <h2>Statistics Overview</h2>
            <div class="stats-grid">
                <div class="stat-card stat-total">
                    <div class="stat-icon"></div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalApps">0</div>
                        <div class="stat-label">Total Applications</div>
                    </div>
                </div>
                <div class="stat-card stat-pending">
                    <div class="stat-icon"></div>
                    <div class="stat-content">
                        <div class="stat-value" id="pendingApps">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                </div>
                <div class="stat-card stat-interview">
                    <div class="stat-icon"></div>
                    <div class="stat-content">
                        <div class="stat-value" id="interviewApps">0</div>
                        <div class="stat-label">Interviews</div>
                    </div>
                </div>
                <div class="stat-card stat-offer">
                    <div class="stat-icon"></div>
                    <div class="stat-content">
                        <div class="stat-value" id="offerApps">0</div>
                        <div class="stat-label">Offers</div>
                    </div>
                </div>
                <div class="stat-card stat-rejected">
                    <div class="stat-icon"></div>
                    <div class="stat-content">
                        <div class="stat-value" id="rejectedApps">0</div>
                        <div class="stat-label">Rejections</div>
                    </div>
                </div>
                <div class="stat-card stat-rate">
                    <div class="stat-icon"></div>
                    <div class="stat-content">
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-label">Interview Rate</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Assistant Section -->
        <div class="ai-assistant-section">
            <div class="section-header">
                <h2> AI Job Application Assistant</h2>
                <span id="aiStatus" class="ai-status">Checking...</span>
            </div>
            
            <div class="ai-container">

                <!-- LLM Selection -->
                <div class="ai-upload-section">
                    <h3>AI Model & Provider</h3>
                    <div class="upload-grid">
                        <div class="upload-field">
                            <label for="aiProvider">AI Provider *</label>
                            <select id="aiProvider" required>
                                <option value="ollama">Ollama (Local)</option>
                                <option value="openai">OpenAI</option>
                                <option value="claude">Claude</option>
                                <option value="gemini">Gemini</option>
                            </select>
                        </div>
                        <div class="upload-field">
                            <label for="aiModel">Model *</label>
                            <select id="aiModel" required></select>
                        </div>
                        <div class="upload-field" id="apiKeyField" style="display:none;">
                            <label for="aiApiKey">API Key</label>
                            <input type="text" id="aiApiKey" placeholder="Enter API key for selected provider">
                        </div>
                    </div>
                </div>

                <!-- Upload CV & Job Info -->
                <div class="ai-upload-section">
                    <h3>Upload & Analyze</h3>
                    <form id="aiAnalysisForm">
                        <div class="upload-grid">
                            <div class="upload-field full-width">
                                <label>Upload Your CV (PDF) *</label>
                                <input type="file" id="cvFile" accept=".pdf" required>
                                <small>Max 5MB - Text-based PDF only</small>
                            </div>
                        </div>
                        
                        <div class="upload-grid">
                            <div class="upload-field">
                                <label>Company Name *</label>
                                <input type="text" id="aiCompany" placeholder="e.g., Google" required>
                            </div>
                            
                            <div class="upload-field">
                                <label>Position *</label>
                                <input type="text" id="aiPosition" placeholder="e.g., Senior Developer" required>
                            </div>
                        </div>
                        
                        <div class="upload-field">
                            <label>Job Description URL (optional)</label>
                            <input type="url" id="jobUrl" placeholder="https://company.com/careers/job-id">
                            <small>Or paste the job description below</small>
                        </div>
                        
                        <div class="upload-field">
                            <label>Job Description (paste here if no URL)</label>
                            <textarea id="jobDescription" rows="6" placeholder="Paste the full job description here..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn-primary btn-analyze">
                            <span class="btn-text">Analyze & Generate Package</span>
                            <span class="btn-loader" style="display:none;">Processing (30-60s)...</span>
                        </button>
                    </form>
                </div>

                <!-- Results Section -->
                <div id="aiResults" class="ai-results" style="display:none;">
                    <div class="results-header">
                        <h3> Your Application Package</h3>
                        <!--  Boutons séparés pour CV et Lettre -->
                        <div class="download-buttons">
                            <button class="btn-primary btn-download" onclick="downloadCVPDF()">
                                 Download CV (PDF)
                            </button>
                            <button class="btn-primary btn-download" onclick="downloadCoverLetterPDF()">
                             Download Cover Letter (PDF)
                            </button>
                        </div>
                    </div>
                    
                    <div class="result-tabs">
                        <button class="tab-btn active" data-tab="analysis"> Analysis</button>
                        <button class="tab-btn" data-tab="cv"> Tailored CV</button>
                        <button class="tab-btn" data-tab="cover">Cover Letter</button>
                        <button class="tab-btn" data-tab="messages"> Recruiter Messages</button>
                    </div>
                    
                    <div class="result-content">
                        <!-- Analysis Tab (non modifiable) -->
                        <div id="tab-analysis" class="tab-pane active">
                            <pre id="analysisContent"></pre>
                        </div>
                        
                        <!-- CV Tab ( MODIFIABLE) -->
                        <div id="tab-cv" class="tab-pane">
                            <div class="copy-hint">
                                 You can edit the CV before downloading or copying
                            </div>
                            <!--  TEXTAREA au lieu de PRE -->
                            <textarea id="cvContent" rows="20" class="editable-content"></textarea>
                            <div class="action-buttons">
                                <button class="btn-secondary btn-copy" onclick="copyToClipboard('cvContent')">
                                     Copy CV
                                </button>
                                <button class="btn-primary" onclick="downloadCVPDF()">
                                     Download CV (PDF)
                                </button>
                            </div>
                        </div>
                        
                        <!-- Cover Letter Tab ( MODIFIABLE) -->
                        <div id="tab-cover" class="tab-pane">
                            <div class="copy-hint">
                                 You can edit the cover letter before downloading or copying
                            </div>
                            <!--  TEXTAREA au lieu de PRE -->
                            <textarea id="coverContent" rows="20" class="editable-content"></textarea>
                            <div class="action-buttons">
                                <button class="btn-secondary btn-copy" onclick="copyToClipboard('coverContent')">
                                     Copy Cover Letter
                                </button>
                                <button class="btn-primary" onclick="downloadCoverLetterPDF()">
                                     Download Cover Letter (PDF)
                                </button>
                            </div>
                        </div>
                        
                        <!-- Recruiter Messages Tab (non modifiable) -->
                        <div id="tab-messages" class="tab-pane">
                            <div class="copy-hint">
                                 Use these templates to reach out to recruiters on LinkedIn or via email
                            </div>
                            <pre id="messagesContent"></pre>
                            <button class="btn-secondary btn-copy" onclick="copyToClipboard('messagesContent')">
                                 Copy Messages
                            </button>
                        </div>
                    </div>
                </div>
                                <!-- Chat Section -->
                <div class="ai-chat-section">
                    <h3> Chat with AI Career Advisor</h3>
                    <div id="chatMessages" class="chat-messages">
                        <div class="chat-message ai">
                            <div class="sender">AI Career Advisor</div>
                            <div class="text">Hi! I'm here to help with your job search. Ask me about interviews, salary negotiation, resume tips, or anything else!</div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chatInput" placeholder="Ask me anything about job applications...">
                        <button onclick="sendChatMessage()" class="btn-primary">Send</button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Job Applications Form -->
        <div class="content">
            <div class="form-section">
                <div class="section-header">
                    <h2 id="formTitle">New Application</h2>
                    <span id="modeBadge" class="mode-badge mode-add">Add</span>
                </div>
                <form id="appForm">
                    <input type="hidden" id="editId" value="">
                    <div class="form-grid">
                        <div class="form-field">
                            <label for="company">Company *</label>
                            <input type="text" id="company" required>
                        </div>
                        <div class="form-field">
                            <label for="position">Position *</label>
                            <input type="text" id="position" required>
                        </div>
                        <div class="form-field">
                            <label for="location">Location</label>
                            <input type="text" id="location">
                        </div>
                        <div class="form-field">
                            <label for="dateApplied">Date Applied *</label>
                            <input type="date" id="dateApplied" required>
                        </div>
                        <div class="form-field">
                            <label for="status">Status *</label>
                            <select id="status" required>
                                <option value="Applied">Applied</option>
                                <option value="Interview Scheduled">Interview Scheduled</option>
                                <option value="Interviewed">Interviewed</option>
                                <option value="Offer Received">Offer Received</option>
                                <option value="Rejected">Rejected</option>
                                <option value="Withdrawn">Withdrawn</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="salary">Salary Range</label>
                            <input type="text" id="salary">
                        </div>
                        <div class="form-field">
                            <label for="contact">Contact Person</label>
                            <input type="text" id="contact">
                        </div>
                        <div class="form-field">
                            <label for="jobUrl">Job URL</label>
                            <input type="url" id="jobUrl">
                        </div>
                    </div>
                    <div class="form-field">
                        <label for="notes">Notes</label>
                        <textarea id="notes"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="submitBtn">Add Application</button>
                        <button type="button" class="btn-secondary" id="cancelBtn" onclick="cancelEdit()">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="table-wrapper">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Company</th>
                                <th>Position</th>
                                <th>Location</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Salary</th>
                                <th>Contact</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                        <div id="emptyState" class="empty">
                            <h3>No applications yet</h3>
                            <p>Add your first job application above to get started</p>
                        </div>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
